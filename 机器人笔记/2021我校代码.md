- [hwy\_part](#hwy_part)
  - [hwy-part/owo](#hwy-partowo)
    - [LABDict.py](#labdictpy)
    - [LABTest.py](#labtestpy)
    - [Camera.py](#camerapy)
    - [Misc.py](#miscpy)
    - [hwy.py](#hwypy)
      - [ruler()函数](#ruler函数)
      - [hole()函数](#hole函数)
      - [mine()](#mine)

# hwy_part
## hwy-part/owo
### LABDict.py 
一些lab颜色的阈值
1. 上下开横杆的黄色和黑色
2. 回型坑绿色
3. 障碍物蓝色
4. 地雷黑色和地面颜色

### LABTest.py
一个用来测试文件，可以读取视频流，在视频流根据轨迹条数值对Lab图像做inrange并显示mask
按空格将中心点lab值各取正负30设置为轨迹条的数值
按w可以向LABDict.py写入保存当前轨迹条阈值为输入的名字

### Camera.py
包括读取机器人摄像头的类
### Misc.py
包括找最大轮廓，获取轮廓位置的函数
### hwy.py
#### ruler()函数
过上下开横栏杆的策略
1. 对图片做三次样条插值缩放到160x120
2. kernel为3x3的高斯模糊
3. 转换为LAB，分别做黄色黑色阈值的inrange，对得到的mask相加
4. 对mask做三次kernel大小为3x3的闭运算
5. 上下左右分别扩充3，3，4，4的黑色边缘
6. 找出最大的轮廓计算其占整个图像的百分比
7. >35判断为横杆还在，计数器加一；小于7时判断为横杆抬起
8. 判断横杆抬起并且计数器超过阈值7则向前走6步
#### hole()函数
过回型坑的策略
1. 机器人看脚下
2. 调整机器人面向回型坑
   1. 3x3核高斯滤波，转lab，对绿色做inrange得mask，三次3x3核开运算，三次3x3核闭运算，找到最大的轮廓作为坑的轮廓
   2. 计算凸包（cv2.convexHull），凸包面积百分比大于阈值74认为调整完成
   3. 在纯色背景上用凸包做填充(cv2.fillPoly),将填充得到的图片对半分为左右两块，分别计算最大轮廓
   4. 两边面积差值大于总面积5%时，左边大左转，右边大右转；否则向前走两步
3. 调整机器人对齐站在坑边
   1. 3x3核高斯滤波，转lab，对绿色做inrange得mask，三次3x3核开运算，七次3x3核闭运算，找到最大的轮廓作为坑的轮廓，黑色背景上填充轮廓为白色
   2. 填充的图片与前面闭运算后的结果做异或运算，在结果上找最大轮廓(找不到更低头再找)
   3. 获取最小外接矩阵，中心点坐标，宽高，旋转角度(cv2.minAreaRect)
   4. 取最近两个点作为底边计算角度和中点到画面下方距离，根据角度阈值，中心的位置阈值，中心点距离画面下方距离作左转，右转，向前走调整
4. 然后右移(or左移？)6步
5. 过坑
   1. 提取[200:480, 210:-220]作为机器人脚前方区域
   2. 3x3核高斯滤波，转lab，对绿色做inrange得mask，三次3x3核开运算，三次3x3核闭运算，找到最大的轮廓作为坑的轮廓并计算占比
   3. 占比大于90往前走两步；大于84走一步；小于5说明已经离开坑；否则按照上面策略计算左右占比差距，较大调整角度，不然向前走
6. 向前走一步，左移7步，向前走一步，恢复站立
#### mine()
过地雷关卡的策略